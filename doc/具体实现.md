# 一、会话与用户管理

# 二、消息处理

## 2.1MsgTHello

### 2.1.1 客户端

客户端应该设置如下几个参数：

Msg必选：

- 协议号 = 1.0  整数；
- 时间戳：毫秒时间戳；
- keyPrint指纹：这里必须是0，表示不加密；
- msgType: hello 类型；



hello 消息必选：

- ClientId: 终端的唯一编码，字符串；
- Platform:所在的平台，字符串；
- Version: 客户端版本号，字符串；
- Stage:客户端应该写"clienthello"，字符串；

hello 可选的参数：
- Lang: 编程语言；

- CountryCode: 国家代码；

- CodeType: 协议编码："json"或者"protobuf"

客户端得到的结果：

1. 当协议号错误，得到协议错误消息；
2. 如果keyprint无法找到，或者keyprint加密数据无法验证，则返回keyprint错误；
4. 如果没有遇到错误，则的可以收到Hello应答；




### 2.1.2 服务端

1. 需要验证协议号是否正确；如果协议版本号不对，则应该返回错误；
2. 如果hello中设置了keyprint，说明以前使用的秘钥，这里需要双向验证一下；
3. 检查ip地址，如果IP设置不合适，应该计算重定向的地址，并返回回去；
4. 如果一起正常，返回hello 应答；



## 2.2 MsgTKeyExchange

参考《DH秘钥交换.md》

暂不实现；



## 2.3 MsgTUserOp

### 2.3.1 请求注册

#### 2.3.1.1 客户端

#### 2.3.1.2 服务端

### 2.3.2 请求注销

### 2.3.3 禁用用户

### 2.3.4 恢复用户

### 2.3.5 请求登录

如果计算IP后，需要重定向，则返回需要重定向的消息；

### 2.3.6 提交验证码

### 2.3.7 设置用户信息

### 2.3.8 搜索用户

### 2.3.9 请求添加好友

### 2.3.10 好友确认

### 2.3.11 移除好友

### 2.3.12 拉黑

### 2.3.13 移除拉黑

### 2.3.14 设置朋友权限

### 2.3.15 设备对方备注







