<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--
    <script src="https://cdn.jsdelivr.net/npm/google-protobuf@latest/google-protobuf.js"></script>
    -->
    <script src="./js/enc.js"></script>
    <script src="./js/wsclient.js"></script>
    <script src="./js/google-protobuf.js"></script>

    <script src="./js/model/chatmsgstatus.js"></script>
    <script src="./js/model/chatmsgtype.js"></script>
    <script src="./js/model/chattype.js"></script>
    <script src="./js/model/commsgtype.js"></script>
    <script src="./js/model/encrypttype.js"></script>
    <script src="./js/model/errormsgtype.js"></script>
    <script src="./js/model/friendopreq.js"></script>
    <script src="./js/model/friendopresult.js"></script>
    <script src="./js/model/groupinfo.js"></script>
    <script src="./js/model/groupmember.js"></script>
    <script src="./js/model/groupoperationresulttype.js"></script>
    <script src="./js/model/groupoperationtype.js"></script>
    <script src="./js/model/groupopreq.js"></script>
    <script src="./js/model/groupopresult.js"></script>
    <script src="./js/model/msg.js"></script>
    <script src="./js/model/msgchat.js"></script>
    <script src="./js/model/msgchatquery.js"></script>
    <script src="./js/model/msgchatqueryresult.js"></script>
    <script src="./js/model/msgchatreply.js"></script>
    <script src="./js/model/msgdownloadreply.js"></script>
    <script src="./js/model/msgdownloadreq.js"></script>
    <script src="./js/model/msgerror.js"></script>
    <script src="./js/model/msgheartbeat.js"></script>
    <script src="./js/model/msghello.js"></script>
    <script src="./js/model/msgkeyexchange.js"></script>
    <script src="./js/model/msgplain.js"></script>
    <script src="./js/model/msgpriority.js"></script>
    <script src="./js/model/msgquery.js"></script>
    <script src="./js/model/msgqueryresult.js"></script>
    <script src="./js/model/msguploadreply.js"></script>
    <script src="./js/model/msguploadreq.js"></script>
    <script src="./js/model/querydatatype.js"></script>
    <script src="./js/model/userinfo.js"></script>
    <script src="./js/model/useroperationtype.js"></script>
    <script src="./js/model/useropreq.js"></script>
    <script src="./js/model/useropresult.js"></script>


</head>
<body>
<div>
    连接地址：<input type="text" id="urlInput" style="width: 400px; height: 30px;" value="wss://127.0.0.1/ws?code=plain">
    <button onclick="connectWebSocket()">连接</button>
</div>

<br>
<div>
    文本消息：<textarea id="msgInput" style="width: 400px; height: 80px; resize: none;">it is a test message.</textarea>

    <button onclick="testSendMessage()">发送</button>
    <button onclick="clearText()">清空</button>
</div>

<br>
<div>
    接收到的消息：<br><textarea id="receiveMsg" rows="15" cols="150"></textarea>
</div>

单用户操作
<hr/>
<div><button onclick="sendHelloMessage()">1.1hello</button>
    <button onclick="sendExMessage1()">1.2 exchangeKey</button>
    <button onclick="sendHelloLogin()">1.3 hello key</button>
</div>
<div><button onclick="sendHeart()">2.心跳</button></div>
<div><button onclick="sendRegister()">3.1 匿名注册</button>
    <button onclick="sendRegister1()">3.2 邮件注册</button></div>

<div><button onclick="sendCode()">4.发送注册验证码</button></div>
<div><button onclick="sendLoginPwdMessage()">5.1 用户密码登录</button></div>
<div>
    <button onclick="sendLoginEmailMessage()">5.2 邮件登录</button>
    <button onclick="sendLoginCodeMessage()">5.3 发送登录验证码</button>
</div>
<div>
    <button onclick="sendUserInfoMessage()">6.1 设置用户基础信息</button>
    <button onclick="sendUserInfoCodeMessage()">6.2 邮箱和手机需要验证</button>
</div>
<div>
    <button onclick="sendUserDisableMessage()">7.1 禁用用户</button>
    <button onclick="sendUserEnableMessage()">7.2 解锁用户</button>
</div>
<div><button onclick="sendUserUnregMessage()">8 注销用户</button></div>
<div><button onclick="sendUserLogoutMessage()">9 退出登录</button></div>

<br>
好友管理
<hr/>
<div><button onclick="sendUserLogoutMessage()">10 查找</button></div>
<div><button onclick="sendUserLogoutMessage()">11 添加好友（关注）</button></div>
<div><button onclick="sendUserLogoutMessage()">12 同意（拒绝）好友请求</button></div>
<div><button onclick="sendUserLogoutMessage()">13 删除好友(关注)</button></div>
<div><button onclick="sendUserLogoutMessage()">14.1 拉黑</button>
    <button onclick="sendUserLogoutMessage()">14.2 解除拉黑</button>
</div>

<div><button onclick="sendUserLogoutMessage()">15 设置权限</button></div>
<div><button onclick="sendUserLogoutMessage()">16 设置好友备注</button></div>

<br>
群组管理
<hr/>
<div><button onclick="sendCreateGroupMessage()">1 创建群组</button></div>
<div><button onclick="sendDisGroupMessage()">2 解散群组</button></div>
<div><button onclick="sendSetGInfoMessage()">3 设置信息</button></div>
<div><button onclick="sendKickGUserMessage()">4 踢人</button></div>
<div><button onclick="sendGInviteMessage()">5 邀请</button></div>
<div><button onclick="sendInviteAnswerMessage()">6 应答邀请（同意，拒绝）</button></div>
<div><button onclick="sendGReqMessage()">7 请求加入</button></div>
<div><button onclick="sendGReqReplyMessage()">8 请求批复（群管理员）</button></div>
<div><button onclick="sendFindGroupMessage()">9 查找</button></div>
<div><button onclick="sendGAddAdminMessage()">10 添加管理员</button></div>
<div><button onclick="sendGRemoveAdminMessage()">11 删除管理员</button></div>
<div><button onclick="sendGChangeOwnerMessage()">12 转让群主</button></div>
<div><button onclick="sendGUserInfoMessage()">13 设置自身备注等信息</button></div>
<div><button onclick="sendGFindUserMessage()">14 搜索群内成员 </button></div>
<div><button onclick="sendGFindMsgMessage()">15  搜索群内消息 </button></div>
<br>
私聊消息
<hr/>
<div><button onclick="sendCreateGroupMessage()">1 普通文本消息</button></div>
<div><button onclick="sendCreateGroupMessage()">2 消息应答</button></div>
<div><button onclick="sendCreateGroupMessage()">2 私聊消息同步</button></div>
<br>
群组消息
<hr/>
<div><button onclick="sendCreateGroupMessage()">1 普通文本消息</button></div>
<div><button onclick="sendCreateGroupMessage()">2 消息应答</button></div>
<div><button onclick="sendCreateGroupMessage()">2 私聊消息同步</button></div>

<br>
上传文件消息
<hr/>

<br>
下载文件消息
<hr/>

<script>
    var client = null;

    function onConnected(){
        console.log("WebSocket connected");
        showMessage("WebSocket connected\n");
    }

    function onDisConnected(){
        console.log("WebSocket disconnected");
    }

    function onMessage(message){
        console.log("Received message callback:", message);
        showMessage(message);
    }

    function onError(error){
        console.error("WebSocket error:", error);
        showMessage(error);
    }
    function onProgress(message){
        showMessage(message);
    }

    function clearText(){
        const receiveMsgTextarea = document.getElementById("receiveMsg");
        receiveMsgTextarea.value = "";
    }


    function connectWebSocket() {

        try {
            //创建 WsClient 实例并连接 WebSocket，并传递回调函数
            if (client === null || client === undefined || !client.isOpen()) {
                const url = document.getElementById("urlInput").value;

                client = new WsClient(
                    "MyClient",
                    url,
                    onMessage,
                    onConnected,
                    onDisConnected,
                    onError,
                    onProgress
                );
            }
            client.connect();
        } catch (e) {
            console.log(e);
        }
    }

    function showMessage(str){
        const receiveMsgTextarea = document.getElementById("receiveMsg");
        receiveMsgTextarea.value += str + "\n";
    }

    function testSendMessage() {
        //showMessage("click")
        const msgInput = document.getElementById("msgInput");
        const msg = msgInput.value;
        // 发送消息
        if (client){
            client.sendWs(msg)
        }
        //msgInput.value = ""; // 清空输入框
    }



    function printByteArray(byteArray) {
        var hexString = '';
        for (var i = 0; i < byteArray.length; i++) {
            var hex = (byteArray[i] & 0xff).toString(16);
            hex = (hex.length === 1) ? '0' + hex : hex;
            hexString += hex + ' ';
        }
        console.log(hexString.trim());
    }




    // 1.hello包
    function sendHelloMessage(){
        if (client){
            client.sendHello();
        }
    }

    function sendHelloLogin(){
        if (client){
           client.sendHello();
        }
    }

    // 2 心跳包
    function sendHeartMessage(){
        if (client){
            client.sendHeart();
        }
    }

    // 发送秘钥交换
    function sendExMessage1(){
        if (client){
            client.sendExchange1();
        }
    }


    //  3. 注册申请
    function sendRegister(){
        if (client) {
            client.sendRegisterMessage("robin", "123456", "", "anonymous"); // 调用类的成员函数
        }
    };

    function sendRegister1(){
        if (client) {
            client.sendRegisterMessage("robin", "123456", "390017268@qq.com", "email"); // 调用类的成员函数
        }
    };

    // 4. 发送验证码
    function sendCode() {
        if (client) {
            client.sendcodeMessage();
        }
    };
    //
    // // 5.1 用户密码登录申请
    // function sendLoginPwdMessage () {
    //     if (client) {
    //         client.sendLoginPwdMessage();
    //     }
    // };
    //
    // // 5.2 用户邮箱登录申请
    // function  sendLoginEmailMessage() {
    //     if (client) {
    //         client.sendLoginEmailMessage();
    //     }
    // };
    //
    // // 5.3 邮箱登录验证码
    // function sendLoginCodeMessage (){
    //     if (client) {
    //         client.sendLoginCodeMessage();
    //     }
    // };
    //
    // // 6.1 设置用户的各种信息
    // function  sendUserInfoMessage (){
    //     if (client) {
    //         client.sendUserInfoMessage();
    //     }
    // };
    //
    // // 6.2 设置用户的各种信息验证码
    // function  sendUserInfoCodeMessage() {
    //     if (client) {
    //         client.sendUserInfoCodeMessage();
    //     }
    // };
    //
    // // 7.1 禁用用户
    // function  sendUserDisableMessage () {
    //     if (client) {
    //         client.sendUserDisableMessage();
    //     }
    // };
    //
    // // 7.2 解禁用户
    // function sendUserEnableMessage (){
    //     if (client) {
    //         client.sendUserEnableMessage();
    //     }
    // };
    //
    // // 8. 注销用户
    // function  sendUserUnregMessage() {
    //     if (client) {
    //         client.sendUserUnregMessage();
    //     }
    // };
    //
    // // 9. 退出登录
    // function  sendUserLogoutMessage () {
    //     if (client) {
    //         client.sendUserLogoutMessage();
    //     }
    // };
    ///////////////////////////////////////////////////////////////////////////////////
    // 好友相关操作


</script>
</body>
</html>
